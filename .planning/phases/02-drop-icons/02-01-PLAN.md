---
phase: 02-drop-icons
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - src/scenes/PreloadScene.js
autonomous: true
requirements:
  - VISC-02

must_haves:
  truths:
    - "Six texture keys (drop_heart, drop_shield, drop_bomb, drop_magnet, drop_boost, drop_elite_shard) exist in the Phaser Texture Manager after PreloadScene.create() runs"
    - "Each texture is 80x80px with a dark semi-transparent backing circle and a distinct icon shape in the correct functional color"
    - "EliteShard texture has a purple-tinted backing, all others have a black backing"
    - "No temp Graphics objects remain in the scene display list after texture generation"
  artifacts:
    - path: "src/scenes/PreloadScene.js"
      provides: "_generateDropTextures() method plus six _drawXxx(gfx) helpers called from create()"
      contains: "generateTexture"
  key_links:
    - from: "src/scenes/PreloadScene.js"
      to: "Phaser Texture Manager"
      via: "gfx.generateTexture(`drop_${type}`, 80, 80)"
      pattern: "generateTexture.*drop_"
    - from: "src/systems/GroundDropManager.js"
      to: "src/scenes/PreloadScene.js"
      via: "scene.add.image(x, y, 'drop_heart') — texture key must exist at spawn time"
      pattern: "drop_heart|drop_shield|drop_bomb|drop_magnet|drop_boost|drop_elite_shard"
---

<objective>
Generate all six ground drop icon textures in PreloadScene.create() using the generateTexture() pattern, so GroundDropManager can spawn sprite-based drops in Plan 02.

Purpose: Creates the pre-baked texture assets (drop_heart through drop_elite_shard) that Plan 02 will consume. Without these textures registered at boot, any scene.add.image(x, y, 'drop_heart') call will produce a white square.

Output: Six 80x80px textures in the Phaser Texture Manager. No runtime Graphics overhead — each texture is drawn once at startup.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-drop-icons/02-CONTEXT.md
@.planning/phases/02-drop-icons/02-RESEARCH.md
@src/scenes/PreloadScene.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add _generateDropTextures() and six icon draw functions to PreloadScene</name>
  <files>src/scenes/PreloadScene.js</files>
  <action>
    In `PreloadScene.create()`, call `this._generateDropTextures()` immediately before `this.scene.start('Menu')`.

    Add the following methods to the PreloadScene class. All shapes must be drawn relative to center (40, 40) of an 80x80 canvas. Use `this.make.graphics({ x: 0, y: 0, add: false })` — the `add: false` flag is CRITICAL to prevent the temp Graphics object from appearing in the scene. Call `gfx.destroy()` immediately after `gfx.generateTexture()`.

    **`_generateDropTextures()`** — iterates type definitions and bakes each texture:

    ```js
    _generateDropTextures() {
      const SIZE = 80;
      const types = {
        heart:        { draw: this._drawHeart.bind(this),       backing: 0x000000 },
        shield:       { draw: this._drawShield.bind(this),      backing: 0x000000 },
        bomb:         { draw: this._drawBomb.bind(this),        backing: 0x000000 },
        magnet:       { draw: this._drawMagnet.bind(this),      backing: 0x000000 },
        boost:        { draw: this._drawBoost.bind(this),       backing: 0x000000 },
        elite_shard:  { draw: this._drawEliteShard.bind(this),  backing: 0x220033 },
      };

      for (const [type, cfg] of Object.entries(types)) {
        const gfx = this.make.graphics({ x: 0, y: 0, add: false });
        // Backing circle (black/purple tint, 60% opacity)
        gfx.fillStyle(cfg.backing, 0.6);
        gfx.fillCircle(40, 40, 40);
        // Icon shape centered at (40, 40)
        cfg.draw(gfx);
        gfx.generateTexture(`drop_${type}`, SIZE, SIZE);
        gfx.destroy();
      }
    }
    ```

    **`_drawHeart(gfx)`** — red heart silhouette, 16-point polygon:

    ```js
    _drawHeart(gfx) {
      const cx = 40, cy = 44, r = 20;
      gfx.fillStyle(0xFF2244, 1);
      gfx.beginPath();
      const pts = [
        { x: cx,           y: cy + r * 0.9  },
        { x: cx - r * 0.55, y: cy + r * 0.35 },
        { x: cx - r * 0.95, y: cy           },
        { x: cx - r * 0.95, y: cy - r * 0.3  },
        { x: cx - r * 0.7,  y: cy - r * 0.6  },
        { x: cx - r * 0.35, y: cy - r * 0.7  },
        { x: cx,            y: cy - r * 0.45  },
        { x: cx + r * 0.35, y: cy - r * 0.7  },
        { x: cx + r * 0.7,  y: cy - r * 0.6  },
        { x: cx + r * 0.95, y: cy - r * 0.3  },
        { x: cx + r * 0.95, y: cy           },
        { x: cx + r * 0.55, y: cy + r * 0.35 },
      ];
      gfx.moveTo(pts[0].x, pts[0].y);
      for (let i = 1; i < pts.length; i++) gfx.lineTo(pts[i].x, pts[i].y);
      gfx.closePath();
      gfx.fillPath();
    }
    ```

    **`_drawShield(gfx)`** — blue pentagon/kite silhouette (matches HUD shield color 0x4488ff):

    ```js
    _drawShield(gfx) {
      const cx = 40, cy = 40;
      gfx.fillStyle(0x4488FF, 1);
      gfx.beginPath();
      gfx.moveTo(cx,      cy + 30);
      gfx.lineTo(cx - 24, cy +  4);
      gfx.lineTo(cx - 26, cy - 14);
      gfx.lineTo(cx,      cy - 22);
      gfx.lineTo(cx + 26, cy - 14);
      gfx.lineTo(cx + 24, cy +  4);
      gfx.closePath();
      gfx.fillPath();
    }
    ```

    **`_drawBomb(gfx)`** — black cartoon bomb with fuse and orange lit tip:

    ```js
    _drawBomb(gfx) {
      const cx = 40, cy = 44;
      // Black body
      gfx.fillStyle(0x111111, 1);
      gfx.fillCircle(cx, cy, 22);
      // White highlight
      gfx.fillStyle(0xffffff, 0.5);
      gfx.fillCircle(cx - 8, cy - 8, 6);
      // Brown fuse
      gfx.lineStyle(4, 0x886633, 1);
      gfx.beginPath();
      gfx.moveTo(cx, cy - 22);
      gfx.lineTo(cx + 8, cy - 32);
      gfx.strokePath();
      // Orange tip
      gfx.fillStyle(0xFF6600, 1);
      gfx.fillCircle(cx + 8, cy - 33, 4);
      gfx.fillStyle(0xFFDD00, 0.8);
      gfx.fillCircle(cx + 8, cy - 33, 2);
    }
    ```

    **`_drawMagnet(gfx)`** — cyan/teal horseshoe U-magnet with red/blue pole tips:

    ```js
    _drawMagnet(gfx) {
      const cx = 40, cy = 42;
      const armW = 10, armH = 20, gapW = 14;
      gfx.fillStyle(0x00DDCC, 1);
      // Left arm
      gfx.fillRect(cx - gapW - armW, cy - armH, armW, armH + 8);
      // Right arm
      gfx.fillRect(cx + gapW,        cy - armH, armW, armH + 8);
      // Top connecting arc approximated as filled rect + circle
      gfx.fillRect(cx - gapW - armW, cy - armH - 14, gapW * 2 + armW * 2, 14);
      gfx.fillCircle(cx, cy - armH - 7, gapW + armW / 2);
      // Pole tips: left=red, right=blue
      gfx.fillStyle(0xFF2222, 1);
      gfx.fillRect(cx - gapW - armW, cy - 4, armW, 12);
      gfx.fillStyle(0x2222FF, 1);
      gfx.fillRect(cx + gapW,        cy - 4, armW, 12);
    }
    ```

    **`_drawBoost(gfx)`** — yellow/orange double-chevron >> (fast-forward arrows):

    ```js
    _drawBoost(gfx) {
      const cx = 40, cy = 40;
      gfx.fillStyle(0xFFCC00, 1);
      // Left chevron
      gfx.beginPath();
      gfx.moveTo(cx - 16, cy - 24);
      gfx.lineTo(cx -  4, cy);
      gfx.lineTo(cx - 16, cy + 24);
      gfx.lineTo(cx -  8, cy + 24);
      gfx.lineTo(cx +  4, cy);
      gfx.lineTo(cx -  8, cy - 24);
      gfx.closePath();
      gfx.fillPath();
      // Right chevron
      gfx.beginPath();
      gfx.moveTo(cx +  2, cy - 24);
      gfx.lineTo(cx + 14, cy);
      gfx.lineTo(cx +  2, cy + 24);
      gfx.lineTo(cx + 10, cy + 24);
      gfx.lineTo(cx + 22, cy);
      gfx.lineTo(cx + 10, cy - 24);
      gfx.closePath();
      gfx.fillPath();
    }
    ```

    **`_drawEliteShard(gfx)`** — purple faceted gem with gold inner facet:

    ```js
    _drawEliteShard(gfx) {
      const cx = 40, cy = 40;
      // Purple gem body
      gfx.fillStyle(0xAA44FF, 1);
      gfx.beginPath();
      gfx.moveTo(cx,      cy - 28);
      gfx.lineTo(cx + 16, cy -  8);
      gfx.lineTo(cx + 18, cy +  8);
      gfx.lineTo(cx,      cy + 28);
      gfx.lineTo(cx - 18, cy +  8);
      gfx.lineTo(cx - 16, cy -  8);
      gfx.closePath();
      gfx.fillPath();
      // Gold inner facet
      gfx.fillStyle(0xFFCC00, 0.6);
      gfx.beginPath();
      gfx.moveTo(cx,     cy - 14);
      gfx.lineTo(cx + 8, cy);
      gfx.lineTo(cx,     cy + 10);
      gfx.lineTo(cx - 8, cy);
      gfx.closePath();
      gfx.fillPath();
    }
    ```

    Placement in file: All six draw methods and `_generateDropTextures()` go after the existing `_removeWhiteBG()` method at the bottom of the class. The `this._generateDropTextures()` call goes in `create()` immediately before `this.scene.start('Menu')`.
  </action>
  <verify>
    <automated>cd "C:/Users/user/Documents/Development/star-assault" && npm run build 2>&1 | tail -5</automated>
    <manual>No "Cannot read properties" errors in build output. All six drop_* texture keys must be reachable: verify by adding a temporary console.log in GameScene that checks this.textures.exists('drop_heart') — expect true.</manual>
    <sampling_rate>Run after this task completes, before Plan 02 begins</sampling_rate>
  </verify>
  <done>npm run build exits with 0 errors. PreloadScene.js contains _generateDropTextures() calling gfx.generateTexture() for all six drop types with { add: false } graphics creation and gfx.destroy() cleanup. create() calls this._generateDropTextures() before this.scene.start('Menu').</done>
</task>

</tasks>

<verification>
- `npm run build` completes without errors
- All six texture key names match exactly: `drop_heart`, `drop_shield`, `drop_bomb`, `drop_magnet`, `drop_boost`, `drop_elite_shard`
- Each texture is 80x80px as specified
- `this.make.graphics({ x: 0, y: 0, add: false })` pattern used (not `this.add.graphics()`)
- Each temp graphics destroyed after generateTexture
- `_generateDropTextures()` called in `create()`, not in `preload()`
</verification>

<success_criteria>
- Six texture keys are registered in the Phaser Texture Manager when GameScene boots
- No blank/white-square sprites when GroundDropManager later calls scene.add.image(x, y, 'drop_heart')
- Build passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/02-drop-icons/02-01-SUMMARY.md`
</output>
