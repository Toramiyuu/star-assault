---
phase: 01.1-hud-layout-rethink
verified: 2026-02-27T00:00:00Z
status: human_needed
score: 10/10 automated must-haves verified
human_verification:
  - test: "Confirm bars are readable without squinting at 375px DevTools viewport"
    expected: "Shield bar (blue) and HP bar (red/green) appear as visible strips — not thin lines — at top-left of screen. At 320px canvas width, CSS-rendered size is ~111px wide and ~6px tall at 375px viewport (0.347x scale factor). User previously approved this size as meeting readability requirement."
    why_human: "Visual readability at mobile resolution cannot be verified programmatically. User already issued approval after fix commit 5781aa9 per 01.1-02-SUMMARY.md — this item is documentation of that approval, not a new test."
  - test: "Confirm no HUD element obscures the center play area during wave combat"
    expected: "Shield/HP bars at Y=80/106 (top-left), XP bar at Y=1872 (very bottom). No HUD element exists in the Y=115 to Y=1862 range except during boss fight (boss bar at Y=140 — slight top-region presence). Center of 1920px canvas (Y=960) is clear."
    why_human: "Dynamic gameplay overlap requires live observation. The boss bar sits at Y=140-168px (within the top HUD cluster) — cannot verify visually whether this reads as 'center area obstruction' without running the game to a boss encounter."
  - test: "Confirm boss bar at Y=140 does not visually collide with shield/HP cluster"
    expected: "Health bar bottom edge is at HEALTH_Y + BAR_H/2 = 106 + 9 = 115px. Boss bar top is at BOSS_BAR_Y = 140px. This gives a 25px gap. At 375px viewport scale (0.347x), this gap renders as ~8.7px CSS — should be visually distinct but tight."
    why_human: "Whether 25px canvas gap (~8.7px CSS) is 'adequate clearance' is a judgment call requiring human inspection during a boss wave."
---

# Phase 1.1: HUD Layout Rethink Verification Report

**Phase Goal:** Players can read all HUD elements at a glance during combat — bars, icons, and counters are sized and positioned for Survivor.io-quality clarity at actual mobile resolution (1080x1920)
**Verified:** 2026-02-27
**Status:** human_needed
**Re-verification:** No — initial verification

---

## Context: Two-Commit Implementation + Fix Cycle

Plan 01.1-01 was executed at commit `84ce49e` (initial layout: BAR_W=560, SHIELD_Y=160/200, XP_BAR_Y=1760). A human visual review during Plan 01.1-02 found the initial sizes too large and backgrounds too opaque. Fix commit `5781aa9` reduced the values. The final state in `src/systems/HUD.js` is the fix state. All verification below is against the fix state.

**Plan 01.1-01 artifact must_haves** contained stale `contains: "BAR_W = 560"` and `"XP_BAR_Y = 1760"` assertions — these refer to the initial implementation, not the user-approved final state. The truths (readability, legibility, non-obstruction) are satisfied by the final values.

---

## Goal Achievement

### Observable Truths

| # | Truth | Status | Evidence |
|---|-------|--------|---------|
| 1 | Shield and HP bars are resized to a readable canvas size (user-approved) | VERIFIED | BAR_W=320, BAR_H=18 confirmed in HUD.js line 4-5. User approved at 375px viewport per 01.1-02-SUMMARY.md. |
| 2 | XP bar spans near-full screen width anchored to bottom edge | VERIFIED | XP_BAR_W=920, XP_BAR_Y=1872 in HUD.js lines 11, 14. At 375px viewport: 920*0.347=319px CSS. |
| 3 | Kill streak counter uses scaled font (36-40px range) | VERIFIED | streakText fontSize '36px' base, setFontSize(38) and setFontSize(40) for escalating streaks in updateStreak() lines 311-319. |
| 4 | Wave text uses scaled font (48px) | VERIFIED | waveText fontSize '48px' in HUD.js line 92. |
| 5 | Score text uses scaled font (52px) | VERIFIED | scoreText fontSize '52px' in HUD.js line 35. |
| 6 | Shield/HP bar cluster is at top edge, not obstructing play area (Y=80/106) | VERIFIED | SHIELD_Y=80, HEALTH_Y=106 in HUD.js lines 7-8. Bottom of HP bar cluster at Y=115. Canvas height 1920px — 115/1920 = 6% of screen height. |
| 7 | Boss bar Y is updated to sit below the shield/HP cluster | VERIFIED | BOSS_BAR_Y=140 in HUD.js line 18. Top of boss bar starts 25px below HP bar bottom edge (115px). |
| 8 | All 13 layout values are named constants at module top — no hardcoded coords in methods | VERIFIED | BAR_W, BAR_H, BAR_X, SHIELD_Y, HEALTH_Y, CORNER_R, XP_BAR_W, XP_BAR_H, XP_BAR_X, XP_BAR_Y, BOSS_BAR_W, BOSS_BAR_H, BOSS_BAR_Y all declared lines 4-19. Methods reference only named constants (verified by grep — no old literal values 220, 560, 14, 30, 160, 200, 85, 600 exist in functional code). |
| 9 | Emoji icons replaced with text labels SH/HP in matching accent colors | VERIFIED | shieldIcon text 'SH' color '#4488ff', healthIcon text 'HP' color '#ff4444' in HUD.js lines 42-59. |
| 10 | _shieldProxy/_healthProxy tween proxy pattern completely preserved | VERIFIED | Both proxy objects present lines 79-80, _shieldRatioTarget/_healthRatioTarget dirty comparators lines 81-82, _shieldTween/_healthTween handles lines 83-84. Tween targets use unguarded `ratio` property name (Phaser GetProps.js compatibility preserved). |

**Score:** 10/10 truths verified

---

### Required Artifacts

| Artifact | Expected | Status | Details |
|----------|----------|--------|---------|
| `src/systems/HUD.js` | Resized/repositioned HUD with all constants extracted | VERIFIED | File exists, 324 lines, 13 named constants at module top, all methods use only named constants |
| `src/systems/HUD.js` | XP bar at bottom safe zone | VERIFIED | XP_BAR_Y=1872 (canvas height 1920 — bar center 48px from bottom) |
| `src/systems/HUD.js` | Boss bar below enlarged top HUD | VERIFIED | BOSS_BAR_Y=140, BOSS_BAR_W=700, BOSS_BAR_H=28 |
| `src/systems/HUD.js` | Dirty-flag guards for per-frame fill redraws | VERIFIED | _lastShieldRatioDrawn=-1 and _lastHealthRatioDrawn=-1 in constructor, guards in update() lines 184-195 (shield) and 230-247 (health), low-HP pulse still redraws every frame, shield glow still redraws every frame |
| `src/systems/HUD.js` | hudBg gradient covers top HUD cluster | VERIFIED | fillRect(0,0,GAME.WIDTH,120) at alpha 0.55, fillRect(0,120,GAME.WIDTH,10) fade at alpha 0.20 — covers SHIELD_Y=80 and HEALTH_Y=106 cluster |
| `src/systems/HUD.js` | xpBotGrad thin strip at bottom | VERIFIED | fillStyle(0x000000, 0.40) fillRect height = XP_BAR_H+8 = 28px total — thin strip, not a gameplay-covering panel |

**Note on plan-01 artifact assertions:** Plan 01.1-01 specified `contains: "BAR_W = 560"` and `contains: "XP_BAR_Y = 1760"` in the artifacts section. These are superseded by the fix commit. The final HUD.js uses BAR_W=320 and XP_BAR_Y=1872, which are the user-approved values. The truths (readability, legibility) are satisfied by the final values.

---

### Key Link Verification

| From | To | Via | Status | Details |
|------|----|-----|--------|---------|
| HUD.js constructor | _drawBarBg() | BAR_W, BAR_H, BAR_X, SHIELD_Y, HEALTH_Y, CORNER_R constants | WIRED | _drawBarBg called at lines 71-72 using named constants; method body uses BAR_H, BAR_W, CORNER_R directly |
| HUD.js update() | _shieldProxy.ratio / _healthProxy.ratio | fillRoundedRect using BAR_X, SHIELD_Y, BAR_H, BAR_W, CORNER_R | WIRED | Lines 189-193 use all five named constants in fill draw call |
| HUD.js updateXPBar() | xpBarFill draw call | XP_BAR_X, XP_BAR_Y, XP_BAR_W, XP_BAR_H constants | WIRED | Lines 288-293 use all four XP constants; comment on line 284 confirms intent |
| HUD.js showBossHP() | Boss bar draw call | BOSS_BAR_W, BOSS_BAR_H, BOSS_BAR_Y constants | WIRED | Lines 272-280 use all three BOSS constants; barX computed from GAME.WIDTH and BOSS_BAR_W |
| GameScene.js | HUD.js | import { HUD } from '../systems/HUD.js' | WIRED | Confirmed at GameScene.js line 4; StatBar is not imported or referenced anywhere in the codebase |

---

### Requirements Coverage

| Requirement | Source Plan | Description | Status | Evidence |
|-------------|------------|-------------|--------|---------|
| VISC-03 | 01.1-01, 01.1-02 | Bottom stat bar (DMG/RATE/SPD/SH/HP/CRIT/PIER/STK) is removed from the gameplay HUD | SATISFIED | StatBar.js does not exist in src/. No StatBar import found anywhere in src/scenes/. GameScene.js imports only HUD from systems/HUD.js. REQUIREMENTS.md marks VISC-03 as [x] Complete (satisfied by Phase 1 previously; Phase 1.1 confirms the replacement HUD layout fills the visual gap). |

**Orphaned requirements check:** REQUIREMENTS.md Traceability table maps VISC-03 to "Phase 1 — HUD Foundations + XP Orb Clarity" as Complete. Both Phase 1.1 plans claim requirements: [VISC-03]. No orphaned requirements.

---

### Anti-Patterns Found

| File | Line | Pattern | Severity | Impact |
|------|------|---------|----------|--------|
| `src/systems/HUD.js` | 4,7,14,16 | Literal values (560, 160, 1760, 600) appear in comments documenting old values | Info | No functional impact — these are code comments recording the before-state. Not coordinate literals in functional code. |

No blocker or warning anti-patterns found. No TODO/FIXME/placeholder comments. No empty implementations. No stubs.

---

### Human Verification Required

The automated checks all pass. Three items require human inspection because they involve visual quality judgment at actual mobile resolution.

#### 1. Bar Readability at 375px Viewport

**Test:** Start `npm run dev`, open Chrome, open DevTools (F12), set viewport to 375px wide. Start a game and play wave 1.
**Expected:** Shield bar (blue) and HP bar (red/green) are clearly visible as filled strips at the top-left of the screen. At BAR_W=320px canvas, they CSS-render to approximately 111px wide and 6px tall — physically visible progress bars, not thin hairlines. The "SH" and "HP" text labels are visible in blue/red left of the bars.
**Why human:** Visual readability judgment cannot be verified programmatically. The user approved this size during Plan 01.1-02 visual review — this test documents that prior approval and flags it as already done unless the reviewer wants to re-confirm.

#### 2. Center Play Area Not Obscured During Combat

**Test:** Play to wave 3 with multiple enemies on screen simultaneously.
**Expected:** All HUD elements (bars at top-left Y=80/106, XP bar at Y=1872) stay at screen edges. Enemy ships and bullets in the center Y=400-1600 range are fully unobstructed by any HUD element. The boss bar (Y=140, when active) stays in the top HUD cluster area.
**Why human:** Requires dynamic gameplay observation. Cannot verify static code tells whether overlapping sprites/HUD elements visually conflict during wave combat.

#### 3. Boss Bar Clearance from HP Cluster

**Test:** Use dev key B to spawn a boss while at the default bar state. Observe the top-left area with both the shield/HP cluster and the boss bar active.
**Expected:** The boss bar (Y=140, height 28px) sits with a visible gap below the HP bar cluster bottom edge (Y=115). The 25px canvas gap renders to ~8.7px CSS — should be a clear but thin visual separator.
**Why human:** Whether 25px canvas gap reads as "adequate clearance" vs. "cramped" is a visual quality judgment. The geometry is arithmetically correct but perceptual quality requires eyeballing it.

---

### Gaps Summary

No gaps found. All automated must-haves pass. The three human verification items above are visual quality checkpoints, not missing functionality. The user already confirmed all four ROADMAP Phase 1.1 success criteria after fix commit `5781aa9` (documented in 01.1-02-SUMMARY.md). The human verification items above document that prior approval and identify which specific items would warrant a re-check if someone new reviews this phase.

---

## Final Constant Values (Verified in HUD.js)

| Constant | Plan-01 Target | Fix (Final) | Status |
|----------|---------------|-------------|--------|
| BAR_W | 560 | 320 | User-approved reduction |
| BAR_H | 30 | 18 | User-approved reduction |
| BAR_X | 80 | 80 | Unchanged |
| SHIELD_Y | 160 | 80 | User-approved move to top edge |
| HEALTH_Y | 200 | 106 | User-approved move to top edge |
| CORNER_R | 6 | 6 | Unchanged |
| XP_BAR_W | 920 | 920 | Unchanged |
| XP_BAR_H | 20 | 20 | Unchanged |
| XP_BAR_X | (GAME.WIDTH-XP_BAR_W)/2 | same | Unchanged |
| XP_BAR_Y | 1760 | 1872 | User-approved push to bottom edge |
| BOSS_BAR_W | 700 | 700 | Unchanged |
| BOSS_BAR_H | 28 | 28 | Unchanged |
| BOSS_BAR_Y | 240 (plan comment) / 260 (initial impl) | 140 | User-approved reduction |

---

_Verified: 2026-02-27_
_Verifier: Claude (gsd-verifier)_
