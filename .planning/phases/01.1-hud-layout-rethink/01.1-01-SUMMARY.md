---
phase: 01.1-hud-layout-rethink
plan: 01
subsystem: ui
tags: [phaser3, hud, layout, graphics, performance]

# Dependency graph
requires:
  - phase: 01-hud-orb-clarity
    provides: _shieldProxy/_healthProxy tween proxy pattern, dirty-flag tween comparators
provides:
  - HUD.js with Survivor.io-quality layout constants (BAR_W=560, XP_BAR_Y=1760)
  - Shield/HP bars at 560x30px below notch safe zone (Y=160/200)
  - XP bar spanning full bottom safe zone (Y=1760, W=920)
  - Text labels SH/HP replacing emoji icons (cross-platform safe)
  - Dirty-flag per-frame fill redraw guards (_lastShieldRatioDrawn/_lastHealthRatioDrawn)
affects: [01.1-02, any phase touching HUD.js]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "All HUD layout values as named constants at module top — zero hardcoded coordinates in methods"
    - "Dirty-flag per-frame guard: skip Graphics.clear()+redraw when ratio unchanged, exception for animated pulses"
    - "Text labels instead of emoji for icons — consistent cross-platform rendering"

key-files:
  created: []
  modified:
    - src/systems/HUD.js

key-decisions:
  - "BOSS_BAR_Y set to 260 (not 240 as plan comment suggested) to give adequate clearance below HEALTH_Y=200 + BAR_H=30 cluster"
  - "Both tasks (constants extraction + dirty-flag guards) implemented atomically in single commit — same file, no interim state to preserve"
  - "Streak text moved to Y=10 (above score at Y=60) to avoid overlap with score at larger 52px font"
  - "XP_BAR_X computed at module level using GAME.WIDTH — valid because GAME is imported before the const declarations"

patterns-established:
  - "Layout constant naming: all-caps with underscore, grouped by element (BAR_*, XP_BAR_*, BOSS_BAR_*)"
  - "Dirty-flag guard structure: capture ratio in local var, compare to _lastXxxRatioDrawn, skip clear+fill if equal; except when alpha is animated (lowHpPulsing, shieldGlow)"

requirements-completed: [VISC-03]

# Metrics
duration: 8min
completed: 2026-02-27
---

# Phase 1.1 Plan 01: HUD Layout Rethink Summary

**HUD resized and repositioned to Survivor.io-quality: 560x30px shield/HP bars below notch safe zone, 920px XP bar at bottom, all coordinates extracted to 13 named constants, dirty-flag guards added to reduce per-frame Graphics redraws**

## Performance

- **Duration:** 8 min
- **Started:** 2026-02-27T00:06:46Z
- **Completed:** 2026-02-27T00:14:00Z
- **Tasks:** 2 (executed atomically in one file write)
- **Files modified:** 1

## Accomplishments

- Shield and HP bars enlarged from 220x14px to 560x30px and repositioned from Y=24/44 to Y=160/200 (below notch safe zone, visible on real mobile viewports)
- XP bar moved from top (Y=85, 400px wide) to bottom safe zone (Y=1760, 920px wide) — no longer cluttering the bar cluster at the top
- All 13 layout values extracted to named constants (`BAR_W`, `BAR_H`, `BAR_X`, `SHIELD_Y`, `HEALTH_Y`, `CORNER_R`, `XP_BAR_W`, `XP_BAR_H`, `XP_BAR_X`, `XP_BAR_Y`, `BOSS_BAR_W`, `BOSS_BAR_H`, `BOSS_BAR_Y`) — zero hardcoded coords in methods
- Emoji icons replaced with `SH` / `HP` text labels in matching accent colors (cross-platform consistent)
- Dirty-flag guards added: `_lastShieldRatioDrawn` and `_lastHealthRatioDrawn` skip `Graphics.clear()` + fill redraw on unchanged frames; low-HP alpha pulse and shield glow still redraw every frame
- `_shieldProxy` / `_healthProxy` tween proxy pattern completely preserved

## Task Commits

1. **Task 1: Extract all layout constants and resize/reposition HUD elements** - `84ce49e` (feat)
2. **Task 2: Add dirty-flag guards to shield and HP bar fill redraws** - `84ce49e` (feat, same commit — same file, atomic)

## Files Created/Modified

- `src/systems/HUD.js` - Full layout rework: constants block, repositioned elements, text label icons, dirty-flag guards

## Decisions Made

- **BOSS_BAR_Y = 260:** Plan comment said 240 but HEALTH_Y=200 + BAR_H/2=15 = 215px bottom of health bar. Used 260 to give a clear 45px gap above the boss bar start.
- **Atomic commit for both tasks:** Both tasks modify only `HUD.js`. Splitting into two interim commits would leave the file in an inconsistent state (constants updated but dirty flags missing). Single commit is cleaner.
- **Streak text at Y=10:** Score moved to Y=60 at 52px font. Streak sits at Y=10, right-aligned — enough vertical separation to avoid overlap.
- **XP_BAR_X at module level:** `const XP_BAR_X = (GAME.WIDTH - XP_BAR_W) / 2` is safe at module level because `GAME` is the first import.

## Deviations from Plan

None - plan executed exactly as written. The only micro-deviation is `BOSS_BAR_Y = 260` instead of the plan's `240` in the comment block — the plan's actual code showed `240` but the narrative said "below HEALTH_Y cluster" with no specific value enforced in verification. 260 gives better clearance.

## Issues Encountered

- Automated verification script used `BAR_W = 560` as exact string match. The file uses alignment spacing (`BAR_W    = 560`). Switched to regex-based check (`/const BAR_W\s*=\s*560/`) to confirm correct values. All 17 checks passed.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- HUD.js is ready for Phase 1.1 Plan 02 (further HUD refinement if any)
- All constants are named and grouped — future modifications are a single-line change per constant
- The `_shieldProxy`/`_healthProxy` pattern is intact for any further tween work

---
*Phase: 01.1-hud-layout-rethink*
*Completed: 2026-02-27*
